두 단계 락킹 규약(Two-Phase Locking, 2PL)은 **트랜잭션이 데이터베이스에서 직렬 가능(serializable)** 하도록 보장하는 **동시성 제어 기법**입니다. 이름처럼 트랜잭션의 **락(lock)** 획득과 해제를 두 단계로 나누는 방식입니다.

---

## ✅ 두 단계 락킹 규약(2PL)이란?

트랜잭션이 락을 사용하는 과정에서 다음 두 단계를 따릅니다:

### 1️⃣ **확장 단계 (Growing Phase)**
- 트랜잭션이 **락을 획득할 수 있지만**, **락을 해제할 수는 없음**
- 이 단계에서 트랜잭션은 읽기/쓰기 위해 공유 락(shared lock), 배타 락(exclusive lock)을 요청함

### 2️⃣ **축소 단계 (Shrinking Phase)**
- 트랜잭션이 **락을 해제할 수 있지만**, **더 이상 새로운 락을 얻을 수 없음**
- 락 하나라도 해제한 순간부터는 새로운 데이터 접근 불가

> 📌 트랜잭션이 락을 걸다가 한 번이라도 락을 해제하면, 더 이상 새로운 락을 요청할 수 없습니다.

---

## 🔒 예시

예를 들어 트랜잭션 T1이 다음과 같은 순서로 실행될 때:

```
T1:
1. X에 대해 Shared Lock 얻기
2. X 읽기
3. Y에 대해 Exclusive Lock 얻기
4. Y 쓰기
5. X 락 해제
6. Y 락 해제
```

여기서 T1은 1~4까지가 **확장 단계**, 5~6은 **축소 단계**에 해당합니다.  
**락 해제를 시작한 후엔 추가로 락을 얻지 않으므로 2PL 규약을 만족**합니다.

---

## ✅ 왜 필요한가요?

- 트랜잭션 간의 **충돌 방지**
- **직렬 가능성(serializability)** 보장
- 동시성 제어에서의 **데이터 일관성 유지**

---

## ⚠️ 주의할 점

| 한계 | 설명 |
|------|------|
| 교착 상태(Deadlock) 발생 가능 | 트랜잭션들이 서로가 가진 락을 기다리면 데드락 발생 |
| 락 보유 시간 증가 | 트랜잭션이 종료되기 전까지 락을 유지하므로 자원 회수 지연 가능 |

이를 해결하기 위한 **변형된 2PL** 방식들도 존재합니다:

### 📌 엄격 2PL (Strict 2PL)
- **모든 배타 락을 트랜잭션 종료 시점까지 유지**
- Recoverability가 좋음

### 📌 강력 2PL (Strong 2PL)
- 모든 락(공유/배타)을 트랜잭션 종료 시점까지 유지

---

필요하시면 실제 DBMS에서 이 규약이 어떻게 적용되는지도 예시 들어서 알려드릴게요.